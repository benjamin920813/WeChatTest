'use strict';

var util = require('./util');
var config = {};
var collection = {};

module['exports'] = function(model, appOptions) {
  collection.model = model;
  config = appOptions;
  return collection;
}

collection.findOne = function*(selector, projection) {
  var data = {};
  if (typeof(selector) == 'string') {
    data.query = {
      _id: selector
    };
  } else {
    data.query = selector;
  }
  data.projection = projection || {};
  console.log(collection.model);
  console.log(data);
  var result = yield util.ajax(config, collection.model, 'findOne', data);
  return result;
}


collection.find = function*(selector, projection, options) {
  var data = {};
  data.query = selector || null;
  data.projection = projection || {};
  data.options = options;
  var result = yield util.ajax(config, collection.model, 'find', data);
  return result;
}

collection.insert = function*(doc) {
  var result = yield util.ajax(config, collection.model, 'insert', {
    document: doc
  });
  return result;
}

collection.update = function*(selector, modifier, options) {
  var data = {};

  data.criteria = selector;
  data.action = modifier;
  data.option = options || {};

  var result = yield util.ajax(config, collection.model, 'update', data);
  return result;
}

collection.remove = function*(selector) {
  var result = yield util.ajax(config, collection.model, 'remove', selector);
  return result;
}

collection.softDelete = function*(selector) {
  console.log('softDelete');
  var result = yield util.ajax(config, collection.model, 'softDelete', selector);
  return result;
}




collection.count = function*(selector) {
  var result = yield util.ajax(config, collection.model, 'count', selector);
  return result;
}