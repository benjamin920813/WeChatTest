var jwt = require('jwt-simple');
var md5 = require('md5');

var util = {};

module.exports = util;


util.unsign = function*(token, secret) {
    var playload = jwt.decode(token, secret);
    return playload;
}

util.sign = function*(playload, secret) {
    return jwt.encode(playload, secret);
}

util.md5 = function*(val) {
    return md5(val);
}

util.getTimestamp = function*() {
    var now = new Date();
    return now.getTime();
}

util.createSessionId = function*(appId, playload, secret) {
    playload.ts = util.getTimestamp();
    var token = yield util.sign(playload, secret)
    return appId + "." + token;
}

util.getToken = function*(sessionId) {
    console.log(sessionId);
    var dotIndex = sessionId.indexOf('.');
    return sessionId.substr(dotIndex + 1);
}

util.getAppId = function*(sessionId) {
    var dotIndex = sessionId.indexOf('.');
    return sessionId.substr(0, dotIndex);
}