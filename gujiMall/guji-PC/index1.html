<!DOCTYPE html>
<html lang="en-us">
	<head>
		<meta charset="utf-8">
		<!--<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">-->

		<title>商品订单</title>
		<meta name="description" content="">
		<meta name="author" content="">
			
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<!-- Basic Styles -->
		<link rel="stylesheet" type="text/css" media="screen" href="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/css/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" media="screen" href="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/css/font-awesome.min.css">

		<!-- SmartAdmin Styles : Please note (smartadmin-production.css) was created using LESS variables -->
		<link rel="stylesheet" type="text/css" media="screen" href="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/css/smartadmin-production.min.css">
		<link rel="stylesheet" type="text/css" media="screen" href="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/css/smartadmin-skins.min.css">

		<!-- SmartAdmin RTL Support is under construction
			 This RTL CSS will be released in version 1.5
		<link rel="stylesheet" type="text/css" media="screen" href="css/smartadmin-rtl.min.css"> -->

		<!-- We recommend you use "your_style.css" to override SmartAdmin
		     specific styles this will also ensure you retrain your customization with each SmartAdmin update.
		<link rel="stylesheet" type="text/css" media="screen" href="css/your_style.css"> -->

		<!-- Demo purpose only: goes with demo.js, you can delete this css when designing your own WebApp -->
		<link rel="stylesheet" type="text/css" media="screen" href="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/css/demo.min.css">

		<!-- FAVICONS -->
		<link rel="shortcut icon" href="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/img/favicon/favicon.ico" type="image/x-icon">
		<link rel="icon" href="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/img/favicon/favicon.ico" type="image/x-icon">

		<!-- GOOGLE FONT -->
		<!-- <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,300,400,700"> -->

		<!-- Specifying a Webpage Icon for Web Clip 
			 Ref: https://developer.apple.com/library/ios/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html -->
		<link rel="apple-touch-icon" href="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/img/splash/sptouch-icon-iphone.png">
		<link rel="apple-touch-icon" sizes="76x76" href="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/img/splash/touch-icon-ipad.png">
		<link rel="apple-touch-icon" sizes="120x120" href="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/img/splash/touch-icon-iphone-retina.png">
		<link rel="apple-touch-icon" sizes="152x152" href="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/img/splash/touch-icon-ipad-retina.png">
		
		<!-- iOS web-app metas : hides Safari UI Components and Changes Status Bar Appearance -->
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		
		<!-- Startup image for web apps -->
		<link rel="apple-touch-startup-image" href="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/img/splash/ipad-landscape.png" media="screen and (min-device-width: 481px) and (max-device-width: 1024px) and (orientation:landscape)">
		<link rel="apple-touch-startup-image" href="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/img/splash/ipad-portrait.png" media="screen and (min-device-width: 481px) and (max-device-width: 1024px) and (orientation:portrait)">
		<link rel="apple-touch-startup-image" href="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/img/splash/iphone.png" media="screen and (max-device-width: 320px)">
		<link rel="stylesheet" href="css/style.css" type="text/css">
		<style>
			nav ul li a {
				line-height: normal!important;
				font-size: 18px!important;
				padding: 10px 10px 10px 11px!important;
				color: white!important;
				display: block!important;
				font-weight: 600!important;
				text-decoration: none!important;
				position: relative!important;
				text-align: center!important;
			}
		</style>
	</head>
	<body class="">
		<!-- Left panel : Navigation area -->
		<!-- Note: This width of the aside area can be adjusted through LESS variables -->
		<aside id="left-panel" style="background:#71843F!important;position:fixed;">

			<!-- User info -->
			<div class="login-info">
				<span> <!-- User image size is adjusted inside CSS, it should stay as it --> 
					
					<a href="javascript:void(0);">
						<img src="img/3.jpg" alt="me" class="online" /> 
						<p>
							南小征
						</p>
					</a> 
					
				</span>
			</div>
			<hr>
			<!-- end user info -->

			<!-- NAVIGATION : This navigation is also responsive

			To make this navigation dynamic please make sure to link the node
			(the reference to the nav > ul) after page load. Or the navigation
			will not initialize.
			-->
			<nav>
				<!-- NOTE: Notice the gaps after each icon usage <i></i>..
				Please note that these links work a bit different than
				traditional href="" links. See documentation for details.
				-->

				<ul>
					<li>
						<a href="index.html" title="商品列表"><span class="menu-item-parent">商品列表</span></a>
					</li>
					<li>
						<a href="index1.html" title="产品订单"><span class="menu-item-parent">商品订单</span></a>
					</li>
					<li>
						<a href="index2.html" title="转手商品"><span class="menu-item-parent">转手商品</span></a>
					</li>
					<li>
						<a href="index3.html" title="用户信息"><span class="menu-item-parent">用户信息</span></a>
					</li>
					<li>
						<a href="index4.html" title="退货申请"><span class="menu-item-parent">退货申请</span></a>
					</li>
				</ul>
			</nav>

		</aside>
		<!-- END NAVIGATION -->

		<!-- MAIN PANEL -->
		<div id="main" role="main">


			<!-- MAIN CONTENT -->
			<div id="content">

				<div class="row">
					<div class="col-xs-12 col-sm-7 col-md-7 col-lg-4">
						<h1 class="page-title txt-color-greenLight">
							<i class="fa fa-pencil-square-o fa-fw "></i> 
								商品订单
						</h1>
					</div>
				</div>
				
				<!-- widget grid -->
				<section id="widget-grid" class="">
				
					<!-- row -->
					<div class="row">

						<!-- NEW COL START -->
						<article class="col-sm-12">
				
							<!-- Widget ID (each widget will need unique ID)-->
							<div class="jarviswidget jarviswidget-color-greenLight" id="page29" data-widget-colorbutton="false" data-widget-editbutton="false" data-widget-custombutton="false"data-widget-togglebutton="false"data-widget-deletebutton="false"data-widget-fullscreenbutton="false">
								<!-- widget options:
								usage: <div class="jarviswidget" id="wid-id-0" data-widget-editbutton="false">
				
								data-widget-colorbutton="false"
								data-widget-editbutton="false"
								data-widget-togglebutton="false"
								data-widget-deletebutton="false"
								data-widget-fullscreenbutton="false"
								data-widget-custombutton="false"
								data-widget-collapsed="true"
								data-widget-sortable="false"
				
								-->
								<header>
									<span class="widget-icon"> <i class="fa fa-edit"></i> </span>
									<h2>商品订单</h2>
								</header>
				
								<!-- widget div-->
								<div class="goods">
									<div class="row">
											
										<div class="col-md-12">
											<div class="icon-addon addon-md">
							                    <input type="text" placeholder="请输入订单信息" class="form-control searchInput">
							                    <label class="glyphicon glyphicon-search" rel="tooltip" title=""></label>
							                </div>
										</div>

									</div>

									<hr/>

									<table class="table bdr">

										<tbody id='orderTable'>

											<!-- <tr>
												<td style="width:170px;"><img src="img/3.jpg"></td>
												<td style="width:20%;" class="infor">
													<div class="name">南小征</div>
													<p>电话：12345678910</p>
													<p>地址：上海浦东新区花木路916号</p>
												</td>
												<td style="width:10%;text-align:center">5件</td>
												<td style="width:15%;text-align:center">￥208.25</td>
												<td style="width:17%;text-align:center">订单号：201509011111001<br><br>2015-09-01 16:05:45</td>
												<td style="width:21%;text-align:center"><a class="btn btn-success btn-sm" href="buy.html">订单详情</a><p class="ture">已发货<span class="glyphicon glyphicon-ok-sign"></span></p></td>
											</tr> -->
											
										</tbody>

									</table>
									
								</div>
								<!-- end widget div -->
				
							</div>
							<!-- end widget -->
				
						</article>
						<!-- END COL -->
				
					</div>
				
					<!-- end row -->
				
				</section>
				<!-- end widget grid -->

			</div>
			<!-- END MAIN CONTENT -->

		</div>
		<!-- END MAIN PANEL -->

		<!-- SHORTCUT AREA : With large tiles (activated via clicking user name tag)
		Note: These tiles are completely responsive,
		you can add as many as you like
		-->
		<div id="shortcut">
			<ul>
				<li>
					<a href="#inbox.html" class="jarvismetro-tile big-cubes bg-color-blue"> <span class="iconbox"> <i class="fa fa-envelope fa-4x"></i> <span>Mail <span class="label pull-right bg-color-darken">14</span></span> </span> </a>
				</li>
				<li>
					<a href="#calendar.html" class="jarvismetro-tile big-cubes bg-color-orangeDark"> <span class="iconbox"> <i class="fa fa-calendar fa-4x"></i> <span>Calendar</span> </span> </a>
				</li>
				<li>
					<a href="#gmap-xml.html" class="jarvismetro-tile big-cubes bg-color-purple"> <span class="iconbox"> <i class="fa fa-map-marker fa-4x"></i> <span>Maps</span> </span> </a>
				</li>
				<li>
					<a href="#invoice.html" class="jarvismetro-tile big-cubes bg-color-blueDark"> <span class="iconbox"> <i class="fa fa-book fa-4x"></i> <span>Invoice <span class="label pull-right bg-color-darken">99</span></span> </span> </a>
				</li>
				<li>
					<a href="#gallery.html" class="jarvismetro-tile big-cubes bg-color-greenLight"> <span class="iconbox"> <i class="fa fa-picture-o fa-4x"></i> <span>Gallery </span> </span> </a>
				</li>
				<li>
					<a href="javascript:void(0);" class="jarvismetro-tile big-cubes selected bg-color-pinkDark"> <span class="iconbox"> <i class="fa fa-user fa-4x"></i> <span>My Profile </span> </span> </a>
				</li>
			</ul>
		</div>
		<!-- END SHORTCUT AREA -->

		<!--================================================== -->

		<!-- PACE LOADER - turn this on if you want ajax loading to show (caution: uses lots of memory on iDevices)-->
		<script data-pace-options='{ "restartOnRequestAfter": true }' src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/plugin/pace/pace.min.js"></script>

		<!-- Link to Google CDN's jQuery + jQueryUI; fall back to local -->
		<script src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/libs/jquery-2.0.2.min.js"></script>
		<script>
			if (!window.jQuery) {
				document.write('<script src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/libs/jquery-2.0.2.min.js"><\/script>');
			}
		</script>

		<!--<script src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/libs/jquery-ui-1.10.3.min.js"></script>
		<script>
			if (!window.jQuery.ui) {
				document.write('<script src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/libs/jquery-ui-1.10.3.min.js"><\/script>');
			}
		</script>-->

		<!-- IMPORTANT: APP CONFIG -->
		<script src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/app.config.js"></script>

		<!-- JS TOUCH : include this plugin for mobile drag / drop touch events-->
		<script src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/plugin/jquery-touch/jquery.ui.touch-punch.min.js"></script> 

		<!-- BOOTSTRAP JS -->
		<script src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/bootstrap/bootstrap.min.js"></script>

		<!-- CUSTOM NOTIFICATION -->
		<script src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/notification/SmartNotification.min.js"></script>

		<!-- JARVIS WIDGETS -->
		<script src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/smartwidgets/jarvis.widget.min.js"></script>

		<!-- EASY PIE CHARTS -->
		<script src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/plugin/easy-pie-chart/jquery.easy-pie-chart.min.js"></script>

		<!-- SPARKLINES -->
		<script src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/plugin/sparkline/jquery.sparkline.min.js"></script>

		<!-- JQUERY VALIDATE -->
		<script src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/plugin/jquery-validate/jquery.validate.min.js"></script>

		<!-- JQUERY MASKED INPUT -->
		<script src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/plugin/masked-input/jquery.maskedinput.min.js"></script>

		<!-- JQUERY SELECT2 INPUT -->
		<script src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/plugin/select2/select2.min.js"></script>

		<!-- JQUERY UI + Bootstrap Slider -->
		<script src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/plugin/bootstrap-slider/bootstrap-slider.min.js"></script>

		<!-- browser msie issue fix -->
		<script src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/plugin/msie-fix/jquery.mb.browser.min.js"></script>

		<!-- FastClick: For mobile devices -->
		<script src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/plugin/fastclick/fastclick.min.js"></script>

		<!--[if IE 8]>

		<h1>Your browser is out of date, please update your browser by going to www.microsoft.com/download</h1>

		<![endif]-->

		<!-- Demo purpose only -->
		<script src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/demo.min.js"></script>

		<!-- MAIN APP JS FILE -->
		<script src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/app.min.js"></script>

		<!-- ENHANCEMENT PLUGINS : NOT A REQUIREMENT -->
		<!-- Voice command : plugin -->
		<script src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/speech/voicecommand.min.js"></script>

		<!-- PAGE RELATED PLUGIN(S) -->
		<script src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/plugin/maxlength/bootstrap-maxlength.min.js"></script>
		<script src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/plugin/bootstrap-timepicker/bootstrap-timepicker.min.js"></script>
		<script src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/plugin/clockpicker/clockpicker.min.js"></script>
		<script src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/plugin/bootstrap-tags/bootstrap-tagsinput.min.js"></script>
		<script src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/plugin/noUiSlider/jquery.nouislider.min.js"></script>
		<script src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/plugin/ion-slider/ion.rangeSlider.min.js"></script>
		<script src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/plugin/colorpicker/bootstrap-colorpicker.min.js"></script>
		<script src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/plugin/knob/jquery.knob.min.js"></script>
		<script src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/plugin/x-editable/moment.min.js"></script>
		<script src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/plugin/x-editable/jquery.mockjax.min.js"></script>
		<script src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/plugin/x-editable/x-editable.min.js"></script>
		<script src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/plugin/typeahead/typeahead.min.js"></script>
		<script src="http://7xjz61.com1.z0.glb.clouddn.com/smartadmin_html/js/plugin/typeahead/typeaheadjs.min.js"></script>
		
		<script src="http://dev.api.zpage.me/sdk.js"></script>
		<script type="text/javascript">
		var data_,orderBuy_;        function compare(propertyName) {             return function (object1, object2) {             var value1 = object1[propertyName];             var value2 = object2[propertyName];             if (value2 < value1) {                 return -1;             }             else if (value2 > value1) {                 return 1;             }             else {                 return 0;             }             }         } 
		$(document).ready(function(){

			var collection_ =shoots.collection("guji");			var lastda = new Array;			var nokey = 0;
			collection_.find({"flag":"buyInfo"},function(err,data){
				if(data.length !=0){
						initWriteDataToTable(data);
				}else{
					alert("没有数据");
				}
			});

			orderSearch();
			function orderSearch(){
				var searchText ='';
				$(".searchInput").on('keyup',function(ev){
					if(ev.keyCode ==13){
						searchText =$(".searchInput").val();
						if(searchText!=''){
							collection_.find({$or:[{"flag":"buyInfo","orderNum":{$regex:searchText}},{"flag":"user","userName":{$regex:searchText}},{"flag":"user","userPhone":{$regex:searchText}}]},function(err,data){
								if(data.length !=0){
									if(data[0].flag ==='user'){
										collection_.find({"flag":"buyInfo","userWxID":data[0].userWxID},function(err,data){
											initWriteDataToTable(data);
										});
									}else{
										initWriteDataToTable(data);
									}

								}else{
									$("#orderTable").children().remove();
									alert("没有数据");
								}
							});
						}else{
							collection_.find({"flag":"buyInfo"},function(err,data){
								if(data.length !=0){
										initWriteDataToTable(data);
								}else{
									alert("没有数据");
								}
							});
						}
					}
				});
			}

			function initWriteDataToTable(data1){
				var html ='';
				data_ =data1;
				$("#orderTable").children().remove();
				for(var i=0;i<data1.length;i++){				    
						$.ajax({
							type:"post",
							url:"../serv/dbsearch/search",
							async:false,
							data :{"flag":"user","userWxID":data1[i].userWxID},
							success : function(data){
								if(data.length !=0){
									name_ =data[0].userName;
									phone_ =data[0].userPhone;
									address_ =data[0].userAddress;																		userFace_ = data[0].userFace;
									if(data1[i].otherAddr){
										$.ajax({
											type:"post",
											url:"../serv/dbsearch/search",
											async:false,
											data :{"flag":"receiveAddrs","timestamp":data1[i].otherAddr,"userWxID":data1[i].userWxID},
											success : function(redata){
												console.log(redata);
												if(redata.length!=0){
													name_ =redata[0].userName;
													phone_ =redata[0].userPhone;
													address_ =redata[0].userAddress;
												}
											}
										});
									}									lastda[nokey] = {};									lastda[nokey].orderNum = data1[i].orderNum;									lastda[nokey].name_ = name_;									lastda[nokey].phone_ = phone_;									lastda[nokey].address_ = address_;									lastda[nokey].userFace_ = userFace_;									lastda[nokey].totalCost = data1[i].totalCost;									lastda[nokey].buyTime = data1[i].buyTime;									lastda[nokey].userWxID = data1[i].userWxID;									lastda.sort(compare("buyTime"));									$("#orderTable").html("");									for(var d=0;d<lastda.length;d++){									if(!lastda) return false;									html = '<tr id='+lastda[d].orderNum+'>'
											+'<td style="width:170px;"><img src="'+lastda[d].userFace_+'"></td>'
											+'<td style="width:20%;" class="infor">'
											+	'<div class="name">'+lastda[d].name_+'</div>'
											+	'<p class="ph">电话：'+lastda[d].phone_+'</p>'
											+	'<p class="ads">地址：'+lastda[d].address_+'</p>'
											+'</td>'											
											+'<td style="width:15%;text-align:center price_">￥'+lastda[d].totalCost+'</td>'
											+'<td style="width:17%;text-align:center">订单号：'+lastda[d].orderNum+'<br><br>'+lastda[d].buyTime+'</td>'
											+'<td style="width:21%;text-align:center"><a class="btn btn-success btn-sm" href="buy.html?wxId='+lastda[d].userWxID+'&orderNum='+lastda[d].orderNum+'">订单详情</a><p class="false isDistribut">未发货<span class="glyphicon"></span></p></td>'
										+'</tr>';									$("#orderTable").append(html);									}
								}
							}
						});						                    nokey++;
				}				
				collection_.find({"flag":"distributionInf_"},function(err,data){
					if(data.length !=0){
						for(var i=0;i<data.length;i++){
							if(data[i].distributionState ==='是'){
								$("#"+data[i].orderNum).find('.isDistribut').attr('class','ture isDistribut');
								$("#"+data[i].orderNum).find('.isDistribut').html('已发货<span class="glyphicon glyphicon-ok-sign"></span>');
							}
						}
					}
				});

				collection_.find({"flag":"userReturnInf"},function(err,data){
					if(data.length !=0){
						for(var i=0;i<data.length;i++){
							if(data[i].isDeal){
								$("#"+data[i].returnOrderNum).find('.isDistribut').attr('class','ture isDistribut');
								$("#"+data[i].returnOrderNum).find('.isDistribut').html('已退货<span class="glyphicon glyphicon-ok-sign"></span>');
							}
						}
					}
				});
			}
		});
		</script>
	</body>

</html>